var motos_json = {
				"motos":[
						    {
								id: 1,
								tipo: "Naked",
								marca: "Yamaha",
								cilindraje: 125,
								modelo: "YBR125 ED",
								colores: ["#ffffff","#000000","#cc0000"],
								rating: 3,
								precio: 80000,
								url_imagenes : ["images/motos/naked/yamaha/125/YBR125_ED/blanco.jpg",
												"images/motos/naked/yamaha/125/YBR125_ED/negro.jpg",
												"images/motos/naked/yamaha/125/YBR125_ED/rojo.jpg"
											   ],
								url_video : "https://www.youtube.com/embed/vUJ4SeEUMpg",
								vendedores : [
											{
												id: 1,
												nombre:"ASSEN MOTOS",
												direccion:"Brandsen 234",
												telefono:"0291 456-5606",
												latitud: -38.720988,
												longitud: -62.256835
											},
											{
												id:2,
												nombre:"EUROMOTO",
												direccion:"Av. Parchappe 1250",
												telefono:"0291 455-7067",
												latitud: -38.724319,
												longitud:  -62.251674
											},
											{
												id:3,
												nombre:"KANDO",
												direccion:"Av. Gral. D. Cerri 765",
												telefono:"0291 452-8726",
												latitud: -38.722134,
												longitud: -62.255279
											}
											]
							},
							{
								id: 2,
								tipo: "Touring",
								marca: "BMW",
								cilindraje: 800,
								modelo:  "F 800 Gs",
								colores: ["#cccccc","#ffffff","#cc0000"],
								rating: 5,
								precio: 250000,
								url_imagenes : ["images/motos/touring/bmw/800/F_800_Gs/blanco_metalizado.jpg",
												"images/motos/touring/bmw/800/F_800_Gs/blanco.jpg",
												"images/motos/touring/bmw/800/F_800_Gs/rojo.jpg"
											   ],
								url_video : "https://www.youtube.com/embed/BaQiI3vkJdA",
								vendedores : [
											{
												id:4,
												nombre:"MotoZone",
												direccion:"Villarino 555",
												telefono:"0291 451-6792",
												latitud: -38.728063,
												longitud: -62.268129
											}, 
											{
												id:3,
												nombre:"KANDO",
												direccion:"Av. Gral. D. Cerri 765",
												telefono:"0291 452-8726",
												latitud: -38.722134,
												longitud: -62.255279
											}
											]
							},
							{
								id: 3,
								tipo: "Scooters",
								marca: "Yamaha",
								cilindraje: 110,
								modelo:  "New Crypton",
								colores: ["#0000ff","#ffffff","#ff0000","#000000"],
								rating: 3,
								precio: 24900,
								url_imagenes : ["images/motos/scooters/yamaha/110/new_crypton/azul.jpg",
												"images/motos/scooters/yamaha/110/new_crypton/blanco.jpg",
												"images/motos/scooters/yamaha/110/new_crypton/rojo.jpg",
												"images/motos/scooters/yamaha/110/new_crypton/negro.jpg"
											   ],
								url_video : "https://www.youtube.com/embed/cTQgJauMgTY",
								vendedores : [
											{
												id:4,
												nombre:"MotoZone",
												direccion:"Villarino 555",
												telefono:"0291 451-6792",
												latitud: -38.728063,
												longitud: -62.268129
											}, 
											{
												id:3,
												nombre:"KANDO",
												direccion:"Av. Gral. D. Cerri 765",
												telefono:"0291 452-8726",
												latitud: -38.722134,
												longitud: -62.255279
											}
											]
							},
							{
								id: 4,
								tipo: "Chopper",
								marca: "Harley Davidson",
								cilindraje: 883,
								modelo:  "Iron",
								colores: ["#ffdf80","#000000","#ff0000"],
								rating: 4,
								precio: 299999,
								url_imagenes : ["images/motos/chopper/Harley_Davidson/883/IRON_883/crema.jpg",
												"images/motos/chopper/Harley_Davidson/883/IRON_883/negro.jpg",
												"images/motos/chopper/Harley_Davidson/883/IRON_883/rojo.jpg"
											   ],
								url_video : "https://www.youtube.com/embed/NcBqvsiw_Yc",
								vendedores : [
											{
												id:4,
												nombre:"MotoZone",
												direccion:"Villarino 555",
												telefono:"0291 451-6792",
												latitud: -38.728063,
												longitud: -62.268129
											}, 
											{
												id:3,
												nombre:"KANDO",
												direccion:"Av. Gral. D. Cerri 765",
												telefono:"0291 452-8726",
												latitud: -38.722134,
												longitud: -62.255279
											},
											{
												id:5,
												nombre:"AUTRAL MOTOS",
												direccion:"Alvarado 824",
												telefono:"0291 452-1800",
												latitud: -38.708323,
												longitud: -62.271433
											}
											]
							},
							{
								id: 5,
								tipo: "Chopper",
								marca: "Harley Davidson",
								cilindraje: 1450,
								modelo:  "Road King",
								colores: ["#0000ff","#cccccc","#ff0000","#1a1a1a"],
								rating: 5,
								precio: 899999,
								url_imagenes : ["images/motos/chopper/Harley_Davidson/1450/ROAD_KING/azul.jpg",
												"images/motos/chopper/Harley_Davidson/1450/ROAD_KING/gris.jpg",
												"images/motos/chopper/Harley_Davidson/1450/ROAD_KING/rojo.jpg",
												"images/motos/chopper/Harley_Davidson/1450/ROAD_KING/negro_opaco.jpeg"
											   ],
								url_video : "https://www.youtube.com/embed/8Xrk8plkTmA",
								vendedores : [
											{
												id:4,
												nombre:"MotoZone",
												direccion:"Villarino 555",
												telefono:"0291 451-6792",
												latitud: -38.728063,
												longitud: -62.268129
											}, 
											{
												id:3,
												nombre:"KANDO",
												direccion:"Av. Gral. D. Cerri 765",
												telefono:"0291 452-8726",
												latitud: -38.722134,
												longitud: -62.255279
											},
											{
												id:5,
												nombre:"AUTRAL MOTOS",
												direccion:"Alvarado 824",
												telefono:"0291 452-1800",
												latitud: -38.708323,
												longitud: -62.271433
											}
											]
							},
							{
								id: 6,
								tipo: "Chopper",
								marca: "Suzuki",
								cilindraje: 125,
								modelo:  "GN 125",
								colores: ["#0000ff","#000000"],
								rating: 3,
								precio: 32499,
								url_imagenes : ["images/motos/chopper/Suziki/125/Gn_125/azul.png",
												"images/motos/chopper/Suziki/125/Gn_125/negro.jpg",
											   ],
								url_video : "https://www.youtube.com/embed/NU8O5oYpISw",
								vendedores : [
											{
												id:4,
												nombre:"MotoZone",
												direccion:"Villarino 555",
												telefono:"0291 451-6792",
												latitud: -38.728063,
												longitud: -62.268129
											}, 
											{
												id:3,
												nombre:"KANDO",
												direccion:"Av. Gral. D. Cerri 765",
												telefono:"0291 452-8726",
												latitud: -38.722134,
												longitud: -62.255279
											},
											{
												id:5,
												nombre:"AUTRAL MOTOS",
												direccion:"Alvarado 824",
												telefono:"0291 452-1800",
												latitud: -38.708323,
												longitud: -62.271433
											}
											]
							},
							{
								id: 7,
								tipo: "Cross",
								marca: "Yamaha",
								cilindraje: 125,
								modelo:  "XTZ 125",
								colores: ["#0000ff","#000000","#ffffff"],
								rating: 3,
								precio: 46500,
								url_imagenes : ["images/motos/cross/yamaha/125/xtz125/azul.jpg",
												"images/motos/cross/yamaha/125/xtz125/negro.jpg",
												"images/motos/cross/yamaha/125/xtz125/blanco.jpg"
											   ],
								url_video : "https://www.youtube.com/embed/7ozKtKojWe8",
								vendedores : [
											{
												id:4,
												nombre:"MotoZone",
												direccion:"Villarino 555",
												telefono:"0291 451-6792",
												latitud: -38.728063,
												longitud: -62.268129
											}, 
											{
												id:3,
												nombre:"KANDO",
												direccion:"Av. Gral. D. Cerri 765",
												telefono:"0291 452-8726",
												latitud: -38.722134,
												longitud: -62.255279
											},
											{
												id: 1,
												nombre:"ASSEN MOTOS",
												direccion:"Brandsen 234",
												telefono:"0291 456-5606",
												latitud: -38.720988,
												longitud: -62.256835
											}
											]
							},
							{
								id: 8,
								tipo: "Scooters",
								marca: "Suzuki",
								cilindraje: 125,
								modelo:  "AN125",
								colores: ["#b3ecff","#c6c5c4","#000000"],
								rating: 2,
								precio: 40790,
								url_imagenes : ["images/motos/scooters/suzuki/125/AN125/celeste.jpg",
												"images/motos/scooters/suzuki/125/AN125/gris.jpg",
												"images/motos/scooters/suzuki/125/AN125/negro.jpg"
											   ],
								url_video : "https://www.youtube.com/embed/CJNbDcFzMnM",
								vendedores : [
											{
												id:5,
												nombre:"AUTRAL MOTOS",
												direccion:"Alvarado 824",
												telefono:"0291 452-1800",
												latitud: -38.708323,
												longitud: -62.271433
											}, 
											{
												id:3,
												nombre:"KANDO",
												direccion:"Av. Gral. D. Cerri 765",
												telefono:"0291 452-8726",
												latitud: -38.722134,
												longitud: -62.255279
											},
											{
												id: 1,
												nombre:"ASSEN MOTOS",
												direccion:"Brandsen 234",
												telefono:"0291 456-5606",
												latitud: -38.720988,
												longitud: -62.256835
											}
											]
							},
							{
								id: 9,
								tipo: "Cross",
								marca: "Honda",
								cilindraje: 250,
								modelo:  "XR 250 Tornado",
								colores: ["#ffffff","#000000","#cc0000"],
								rating: 4,
								precio: 84000,
								url_imagenes : ["images/motos/cross/honda/250/XR250_tornado/blanco.jpg",
												"images/motos/cross/honda/250/XR250_tornado/negro.jpg",
												"images/motos/cross/honda/250/XR250_tornado/rojo.jpg"
											   ],
								url_video : "https://www.youtube.com/embed/a2btxvIq0Kc",
								vendedores : [
											{
												id:5,
												nombre:"AUTRAL MOTOS",
												direccion:"Alvarado 824",
												telefono:"0291 452-1800",
												latitud: -38.708323,
												longitud: -62.271433
											}, 
											{
												id:3,
												nombre:"KANDO",
												direccion:"Av. Gral. D. Cerri 765",
												telefono:"0291 452-8726",
												latitud: -38.722134,
												longitud: -62.255279
											},
											{
												id: 1,
												nombre:"ASSEN MOTOS",
												direccion:"Brandsen 234",
												telefono:"0291 456-5606",
												latitud: -38.720988,
												longitud: -62.256835
											},
											{
												id:4,
												nombre:"MotoZone",
												direccion:"Villarino 555",
												telefono:"0291 451-6792",
												latitud: -38.728063,
												longitud: -62.268129
											},
											]
							},
							{
								id: 10,
								tipo: "Naked",
								marca: "Suzuki",
								cilindraje: 125,
								modelo:  "EN125-2a",
								colores: ["#000000","#cc0000","#ffff00"],
								rating: 3,
								precio: 84000,
								url_imagenes : [
												"images/motos/naked/suzuki/125/EN_125/negro.jpg",
												"images/motos/naked/suzuki/125/EN_125/rojo.jpg",
												"images/motos/naked/suzuki/125/EN_125/amarillo.jpg"
											   ],
								url_video : "https://www.youtube.com/embed/rV7T_YNLy7c",
								vendedores : [
											{
												id:5,
												nombre:"AUTRAL MOTOS",
												direccion:"Alvarado 824",
												telefono:"0291 452-1800",
												latitud: -38.708323,
												longitud: -62.271433
											}, 
											{
												id:3,
												nombre:"KANDO",
												direccion:"Av. Gral. D. Cerri 765",
												telefono:"0291 452-8726",
												latitud: -38.722134,
												longitud: -62.255279
											}
											
											]
							}
						]
			};


var color_select = 0;
var moto_select = null;
var marcadores = [];

var marcas = [];
var tipos = [];
var cilindrajes = [];

$(document).ready(function() {
	cargar_datos(motos_json.motos);
    $('#tipo').change(function () {
    	filtrar(motos_json.motos);
    });
    $('#marca').change(function () {
    	filtrar(motos_json.motos);
    });
    $('#cilindraje').change(function () {
    	filtrar(motos_json.motos);
    });
    $('#modelo').change(function () {
    	filtrar(motos_json.motos);
    });
});

function cargar_datos(){
	var motos = motos_json.motos;
	$("#tipo").empty();
	$("#marca").empty();
	$("#cilindraje").empty();
	$("#modelo").empty();
	marcas = [];
    tipos = [];
    cilindrajes = [];

	$("#tipo").append('<option data-tokens=""></option>');
	$("#marca").append('<option data-tokens=""></option>');
	$("#cilindraje").append('<option data-tokens=""></option>');
	$("#modelo").append('<option data-tokens=""></option>');
	for (var i = 0; i < motos.length; i++) {
		if (!existe_opcion(tipos,motos[i].tipo)){
			$("#tipo").append('<option data-tokens="' + motos[i].tipo + '">' + motos[i].tipo + '</option>');
			tipos.push(motos[i].tipo);
		}
		if (!existe_opcion(marcas,motos[i].marca)){
			$("#marca").append('<option data-tokens="' + motos[i].marca + '">' + motos[i].marca + '</option>');
			marcas.push(motos[i].marca);
		}
		if (!existe_opcion(cilindrajes,motos[i].cilindraje)){
			$("#cilindraje").append('<option data-tokens="' + motos[i].cilindraje + '">' + motos[i].cilindraje + 'cc</option>');
			cilindrajes.push(motos[i].cilindraje);
		}
	}
	$("#tipo").selectpicker('refresh');
	$("#marca").selectpicker('refresh');
	$("#cilindraje").selectpicker('refresh');
	$("#modelo").selectpicker('refresh');
}

function limpiar_busqueda(){
	cargar_datos();
	$("#imagen_moto").attr("src", "images/moto.png");
	$("#video").attr("src", "https://www.youtube.com/embed/gn1AeD95BxY");
	$("#precio").text("$0");
	$("#colores").empty();
	$("#estrellas").empty();
	for (var j = 0; j < 5; j++) {
		$("#estrellas").append('<span class="estrella glyphicon glyphicon-star-empty" aria-hidden="true"></span>');
	}
	color_select = 0;
	moto_select = null;
	$("#descargar_moto").removeAttr('download');
	$("#descargar_moto").removeAttr('href');
	$("#descargar_json").removeAttr('href');
	$("#modelo").attr('disabled',true);
	$('#modelo').selectpicker('refresh');
	limpiar_mapa();
}

function filtrar(motos){
	var tipo = $("#tipo").find("option:selected").data("tokens");
	var marca = $("#marca").find("option:selected").data("tokens");
	var cilindraje = $("#cilindraje").find("option:selected").data("tokens");
	var modelo = $("#modelo").find("option:selected").data("tokens");

	$("#tipo").empty();
	$("#marca").empty();
	$("#cilindraje").empty();
	$("#modelo").empty();
	marcas = [];
    tipos = [];
    cilindrajes = [];

	if (tipo=="") 
		$("#tipo").append('<option data-tokens=""></option>');

	if (marca=="")
		$("#marca").append('<option data-tokens=""></option>');

	if (cilindraje=="")
		$("#cilindraje").append('<option data-tokens=""></option>');	

	if (modelo==""){
		$("#modelo").append('<option data-tokens=""></option>');

		for (var i = 0; i < motos.length; i++) {
			if (cumple_filtrado(motos[i], tipo, marca, cilindraje)){

					if (!existe_opcion(tipos,motos[i].tipo)){
						$("#tipo").append('<option data-tokens="' + motos[i].tipo + '">' + motos[i].tipo + '</option>');
						tipos.push(motos[i].tipo);
					}
					if (!existe_opcion(marcas,motos[i].marca)){
						$("#marca").append('<option data-tokens="' + motos[i].marca + '">' + motos[i].marca + '</option>');
						marcas.push(motos[i].marca);
					}
					if (!existe_opcion(cilindrajes,motos[i].cilindraje)){
						$("#cilindraje").append('<option data-tokens="' + motos[i].cilindraje + '">' + motos[i].cilindraje + 'cc</option>');
						cilindrajes.push(motos[i].cilindraje);
					}

					if(tipo!="" && marca!="" && cilindraje!=""){
						$("#modelo").removeAttr('disabled');
						$("#modelo").append('<option data-tokens="' + motos[i].modelo + '">' + motos[i].modelo + '</option>');
					}
			}
		}
	
		$("#tipo").selectpicker('refresh');
		$("#marca").selectpicker('refresh');
		$("#cilindraje").selectpicker('refresh');
		$("#modelo").selectpicker('refresh');
	}
	else{
		var i=0;
		encontre = false;
		while (!encontre && i<motos.length) {
			if (es_moto_seleccionada(motos[i], tipo, marca, cilindraje,modelo)){
				encontre=true;
				moto_select=motos[i];

				$("#1").slideUp(200,function() {
					  	$("#imagen_moto").attr("src", moto_select.url_imagenes[color_select]);
					    $('#1').slideDown(200,function(){
					    	$('#1').css('display', '');
					    });
   				});

				$("#video").attr("src", motos[i].url_video);
				$("#precio").text('$'+motos[i].precio);
				$("#estrellas").empty();
				$("#descargar_json").attr('href',"data:text/plain;charset=UTF-8," + encodeURIComponent(JSON.stringify(moto_select,null,2)));

				for (var j = 0; j < motos[i].rating; j++) {
					$("#estrellas").append('<span class="estrella glyphicon glyphicon-star" aria-hidden="true"></span>');
				}
				for (var j = 0; j < (5-motos[i].rating); j++) {
					$("#estrellas").append('<span class="estrella glyphicon glyphicon-star-empty" aria-hidden="true"></span>');
				}

				for (var j = 0; j < motos[i].colores.length; j++) {
					$("#colores").append('<div id="color'+j+'" data-color="'+j+'" class="box_color"></div>');
					$("#color"+j).css('background-color', motos[i].colores[j]);

					$("#color"+j).click(function() {
					  var color= $(this).data("color");

					  $("#1").slideUp(200,function() {
					  	$("#imagen_moto").attr("src", moto_select.url_imagenes[color]);
					    $('#1').slideDown(200,function(){
					    	$('#1').css('display', '');
					    });

   				  	  });

					  
					  $(this).css('border', '3px solid #009999');
					  $("#color"+color_select).css('border', '1px solid black');
					  $("#descargar_moto").attr('href',moto_select.url_imagenes[color]);
					  color_select= color;
					});

					if (j==0){
						color_select = 0;
						$("#color"+0).css('border', '3px solid #009999');
						$("#descargar_moto").attr('download',true);
						$("#descargar_moto").attr('href',moto_select.url_imagenes[0]);
					}
				}

				agregar_venderdores_mapa(motos[i].vendedores);
			}
			i++;
		}
	}

}

function cumple_filtrado(moto, tipo, marca, cilindraje){
	if ((moto.tipo==tipo || tipo=="") && (moto.marca==marca || marca=="") && (moto.cilindraje==cilindraje || cilindraje==""))
		return true;
	else
		return false;
}

function es_moto_seleccionada(moto, tipo, marca, cilindraje, modelo){
	if (moto.tipo==tipo && moto.marca==marca && moto.cilindraje==cilindraje && moto.modelo==modelo)
		return true;
	else
		return false;
}

function agregar_venderdores_mapa(vendedores){
	limpiar_mapa();
	var mapCanvas = document.getElementById("googleMap");
	var centrado = new google.maps.LatLng(vendedores[0].latitud,vendedores[0].longitud);
	var mapOptions = {center: centrado, zoom: 15};
	map = new google.maps.Map(mapCanvas, mapOptions);
	var html;
	var icon = {
		    url: "images/marker_moto.png", // url
		    scaledSize: new google.maps.Size(50, 50), // scaled size
		    origin: new google.maps.Point(0,0), // origin
		    anchor: new google.maps.Point(0, 0) // anchor
	};

	for (var i = 0; i < vendedores.length; i++) {
		var marker;
		var myCenter = new google.maps.LatLng(vendedores[i].latitud,vendedores[i].longitud);
		html = preparar_info_window(vendedores[i]);
						  
		var infowindow = new google.maps.InfoWindow();

		

		marker = new google.maps.Marker({
						  					position:myCenter,
						  					icon: icon,
						  					contentString: html,
						  					map: map,
				  						});
						 
		var infowindow = new google.maps.InfoWindow({});

		marker.addListener('click', function() {
		    infowindow.setContent(this.contentString);
		    infowindow.open(map, this);
		});

		marcadores.push(marker);
	}

}

function preparar_info_window(vendedor){
	html="<h3 style='text-aling:center'>"+vendedor.nombre+"</h3>";
	html+="<p><strong>Telefono:</strong> "+vendedor.telefono+"</p>";
	html+="<p><strong>Direcci√≥n:</strong> "+vendedor.direccion+"</p>";
	return html;
}

function limpiar_mapa(){
	var marcador = marcadores.pop();
	while (marcador!=null){
		marcador.setMap(null);
		var marcador = marcadores.pop();
	}
}

function existe_opcion(opciones,valor){
	var existe=false;
	i=0;
	while (i<opciones.length && !existe) {
        if(opciones[i]==valor)
        	existe=true;
        i++;
    }
    return existe
}